{% extends 'new_base.html' %}
{% load static %}
{% block title %}Auctions | {{ title }} {% endblock %}

{% block body %}
    <div class="container">
        <div class="auctions-header-container">
            <!-- Page Heading -->
            <h1 class='h3 mb-4 text-gray-800'>{{ title }} - {{ auctions_count }} Results</h1>
            <!-- Filters and Sorting -->
            <div class="filters mb-4">
                <form id="filter-form" method="get" class="form-inline">
                    <div class="form-group mb-2">
{#                        <label for="time-filter" class="mr-2">Time Filter</label>#}
                        <select id="time-filter" name="time_filter" class="form-control">
                            <option value="">Filter By: All Times</option>
                            <option value="today">Today</option>
                            <option value="tomorrow">Tomorrow</option>
                            <option value="next_3_days">Next 3 Days</option>
                        </select>
                    </div>

                    <div class="form-group mb-2">
{#                        <label for="sort-by" class="mr-2">Sort By</label>#}
                        <select id="sort-by" name="sort_by" class="form-control">
                            <option value="">Sort By: Best Match</option>
                            <option value="ending_soonest">Ending Soonest</option>
                            <option value="newly_listed">Newly Listed</option>
                            <option value="price_highest">Price Highest</option>
                            <option value="price_lowest">Price Lowest</option>
                            <option value="fewest_bids">Fewest Bids</option>
                            <option value="most_bids">Most Bids</option>
                        </select>
                    </div>
                </form>
            </div>
        </div>

        <div class='mb-4'>
            <div class='card-body'>


                <div class='col align-items-center'>
                    {% for auction in pages %}
                        <div class='col mb-5'>

                            <div class='listing'>
                                <a class='auction-card text-decoration-none'
                                   href="{% url 'auction_details_view' auction.id %}">
                                    <!-- Product image-->
                                    <div class='auction_image_first d-flex justify-content-center'>
                                        <div class='auction_image_second'>
                                            <img class='auction_image_third'
                                                 src="{{ auction.image.image.url|default:'../static/images/no_image.png' }}"
                                                 alt='Product image'>
                                        </div>
                                    </div>

                                    <!-- Product details-->

                                    <div class='card-body p-3'>

                                        <div class='text-left'>
                                            <!-- Product name-->
                                            <div class='auction-title'>{{ auction.title }}</div>
                                            <div class="display-8">{{ auction.category }}</div>

                                            <h3>
                                                <div class="two-grid-auto-columns mt-2 auction-price">
                                                    <!-- Product price-->
                                                    {% if auction.current_bid %}
                                                        ${{ auction.current_bid }}
                                                    {% else %}
                                                        ${{ auction.starting_bid }}
                                                    {% endif %}
                                                </div>
                                            </h3>
                                            <div class='two-grid-auto-columns'>
                                                <div class="lead time-remaining">{{ auction.formatted_time_remaining }}
                                                    Remaining
                                                </div>
                                            </div>
                                            <div class="two-grid-auto-columns mt-1">
                                                <div class="">Quantity:</div>
                                                <div>{{ auction.quantity_available }}</div>
                                            </div>
                                            <div class="d-flex gap-1 mt-1" id="auction-attributes">
                                                {% if auction.udi %}
                                                    <div class="">UDI:</div>
                                                    <div>{{ auction.udi }},</div>
                                                {% endif %}

                                                {% if auction.reference_number %}
                                                    <div class="">Reference#</div>
                                                    <div>{{ auction.reference_number }},</div>
                                                {% endif %}

                                                {% if auction.lot_number %}
                                                    <div class="">Lot#</div>
                                                    <div>{{ auction.lot_number }},</div>
                                                {% endif %}

                                                {% if auction.expiration_date %}
                                                    <div class="">Exp Date:</div>
                                                    <div>{{ auction.expiration_date }}</div>
                                                {% endif %}
                                            </div>

                                            <!-- Display watchers and bids count -->
                                            <div class="d-flex gap-1 mt-1" id="auction-stats">
                                                <div>Watchers: {{ auction.watchers.count }}</div>
                                                <div>Bids: {{ auction.bid_set.count }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                                <div class="bid-form pe-3">
                                    <h5>Place Your Bid</h5>
                                    <div class='form-group'>
                                        <form action="{% url 'auction_bid' auction.id %}" method='POST'>
                                            {% csrf_token %}
                                            <div class='form-group with-symbol extra-m'>
                                                {{ bid_form.amount }}
                                                <br>
                                                <button type='submit' class='btn btn-primary'>
                                                    Place a bid
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}

                    {% if pages.has_other_pages %}
                        <div class='d-flex justify-content-center'>
                            <ul class='pagination'>
                                {% if pages.has_previous %}
                                    <li class='page-item'>
                                        <a class='page-link' href='?page={{ pages.previous_page_number }}'>
                                            &laquo;
                                        </a>
                                    </li>
                                {% else %}
                                    <li class='page-item disabled'>
                                        <a class='page-link' href='#'>&laquo;</a>
                                    </li>
                                {% endif %}
                                {% for i in pages.paginator.page_range %}
                                    {% if pages.number == i %}
                                        <li class='page-item active'>
                                            <a class='page-link' href='#'>{{ i }}</a>
                                        </li>
                                    {% else %}
                                        <li class='page-item'>
                                            <a class='page-link' href='?page={{ i }}'>{{ i }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                {% if pages.has_next %}
                                    <li class='page-item'>
                                        <a class='page-link' href='?page={{ pages.next_page_number }}'>
                                            &raquo;
                                        </a>
                                    </li>
                                {% else %}
                                    <li class='page-item disabled'>
                                        <a class='page-link' href='#'>&raquo;</a>
                                    </li>
                                {% endif %}
                            </ul>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <link href='{% static "css/auctions_view.css" %}' rel='stylesheet'>
    <script src='{% static "js/auctions_active.js" %}'></script>
{% endblock %}
