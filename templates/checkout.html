{% extends 'new_base.html' %}
{% load static %}
{% block title %}Checkout{% endblock %}
{% block body %}
    <div class="container">
        <form method="post">
            {% csrf_token %}

            <!-- Tabs Navigation -->
            <ul class="nav nav-tabs border-0" id="checkoutTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact"
                            type="button" role="tab" aria-controls="contact" aria-selected="true">Contact & Shipping
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="confirmation-tab" data-bs-toggle="tab" data-bs-target="#confirmation"
                            type="button" role="tab" aria-controls="confirmation" aria-selected="false">Order
                        Confirmation
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="payment-tab" data-bs-toggle="tab" data-bs-target="#payment"
                            type="button" role="tab" aria-controls="payment" aria-selected="false">Payment & Submit
                    </button>
                </li>
            </ul>
            <!-- Tabs Content -->
            <div class="tab-content card " id="checkoutTabContent">
                <!-- Contact & Shipping -->
                <div class="tab-pane fade show active" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <h3 class="m-0">Order Contact Information</h3>
                        <span class="edit-button" onclick="toggleEdit('order-contact')">Edit</span>
                    </div>
                    <div class="card-body" id="order-contact">
                        <div class="form-group mb-3 row align-items-center order-contact-info">
                            <div class="col-2">
                                <label for="id_name">Name</label>
                            </div>
                            <div class="col-4">
                                <input type="text" class="form-control required" id="id_name" name="name"
                                       placeholder="Enter Name"
                                       value="{{ request.user.first_name }} {{ request.user.last_name }} " required>
                            </div>
                        </div>
                        <div class="form-group mb-3 row align-items-center order-contact-info">
                            <div class="col-2">
                                <label for="id_email">Email Address</label>
                            </div>
                            <div class="col-4">
                                <input type="email" class="form-control required" id="id_email" name="email"
                                       placeholder="Enter email"
                                       value="{{ request.user.email }}" required>
                            </div>
                        </div>
                        <div class="form-group  mb-3 row align-items-center order-contact-info">
                            <div class="col-2">
                                <label for="id_phone_number">Phone Number</label>
                            </div>
                            <div class="col-4">
                                <input type="text" class="form-control required" id="id_phone_number"
                                       name="phone_number"
                                       placeholder="Enter phone number" value="{{ request.user.phone_number }}">
                            </div>
                        </div>
                    </div>
                    <div class="card-header border-top d-flex align-items-center justify-content-between">
                        <h3 class="m-0">Shipping & Billing Information</h3>
                        <span class="edit-button" onclick="toggleEdit('order-shipping-billing')">Edit</span>
                    </div>
                    <div class="card-body" id="order-shipping-billing">
                        <div class="shipping-billing-container">
                            <div class="col pe-5 bs-contact-container">
                                <h4 class="text-muted mt-3">Ship To Contact</h4>
                                <div class="ps-3 bs-contact-container">
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="col-4">
                                            <label for="{{ shipping_form.shipping_full_name.id_for_label }}">Attention</label>
                                        </div>
                                        <div class="col-8">
                                            {{ shipping_form.shipping_full_name }}
                                            {% if shipping_form.shipping_full_name.errors %}
                                                <div class="text-danger">{{ shipping_form.shipping_full_name.errors }}</div>
                                            {% endif %}

                                        </div>
                                    </div>
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="col-4">
                                            <label for="{{ shipping_form.shipping_phone_number.id_for_label }}">Shipping
                                                Phone</label>
                                        </div>
                                        <div class="col-8">
                                            {{ shipping_form.shipping_phone_number }}
                                            {% if shipping_form.shipping_phone_number.errors %}
                                                <div class="text-danger">{{ shipping_form.shipping_phone_number.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="col-4">
                                            <label for="{{ shipping_form.shipping_email.id_for_label }}">Shipping
                                                Email</label>
                                        </div>
                                        <div class="col-8 d-flex align-items-center">
                                            {{ shipping_form.shipping_email }}
                                            {#                                            <button type="button" class="btn btn-secondary ms-2" id="copyEmailButton">#}
                                            {#                                                Copy Email#}
                                            {#                                            </button>#}
                                            {% if shipping_form.shipping_email.errors %}
                                                <div class="text-danger">{{ shipping_form.shipping_email.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <h4 class="text-muted">Ship To Address</h4>
                                <div class="ps-3 bs-contact-container">
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="col-4">
                                            <label for="{{ shipping_form.shipping_street_address.id_for_label }}">Street
                                                Address
                                                1</label>
                                        </div>
                                        <div class="col-8">
                                            {{ shipping_form.shipping_street_address }}
                                            {% if shipping_form.shipping_street_address.errors %}
                                                <div class="text-danger">{{ shipping_form.shipping_street_address.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="col-4">
                                            <label for="{{ shipping_form.shipping_apartment_suite.id_for_label }}">Street
                                                Address 2</label>
                                        </div>
                                        <div class="col-8">
                                            {{ shipping_form.shipping_apartment_suite }}
                                            {% if shipping_form.shipping_apartment_suite.errors %}
                                                <div class="text-danger">{{ shipping_form.shipping_apartment_suite.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="row p-0 ms-0 city-state-zip-container">
                                            <div class="col-4 filler-column"></div>
                                            <div class="col-8" id="address-container">
                                                <div class="row">
                                                    <div class="col-6 city-col" id="city-col">
                                                        <div class="form-group align-items-center">
                                                            {{ shipping_form.shipping_city }}
                                                            <label class="ps-2"
                                                                   for="{{ shipping_form.shipping_city.id_for_label }}">City</label>
                                                            {% if shipping_form.shipping_city.errors %}
                                                                <div class="text-danger">{{ shipping_form.shipping_city.errors }}</div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                    <div class="col-3 state-col" id="state-col">
                                                        <div class="form-group align-items-center">
                                                            {{ shipping_form.shipping_state }}
                                                            <label class="ps-2"
                                                                   for="{{ shipping_form.shipping_state.id_for_label }}">State</label>
                                                            {% if shipping_form.shipping_state.errors %}
                                                                <div class="text-danger">{{ shipping_form.shipping_state.errors }}</div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                    <div class="col-3 zip-col" id="zip-col">
                                                        <div class="form-group align-items-center">
                                                            {{ shipping_form.shipping_zip_code }}
                                                            <label class="ps-2"
                                                                   for="{{ shipping_form.shipping_zip_code.id_for_label }}">Zip</label>
                                                            {% if shipping_form.shipping_zip_code.errors %}
                                                                <div class="text-danger">{{ shipping_form.shipping_zip_code.errors }}</div>
                                                            {% endif %}

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="col-4">
                                            <label for="{{ shipping_form.shipping_country.id_for_label }}">Shipping
                                                Country</label>
                                        </div>
                                        <div class="col-8">
                                            {{ shipping_form.shipping_country }}
                                            {% if shipping_form.shipping_country.errors %}
                                                <div class="text-danger">{{ shipping_form.shipping_country.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col ps-5 bs-contact-container">
                                <h4 class="text-muted mt-3">Bill To Contact</h4>
                                <div class="ps-3 bs-contact-container">
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="col-4">
                                            <label for="{{ billing_form.billing_full_name.id_for_label }}">Attention</label>
                                        </div>
                                        <div class="col-8">
                                            {{ billing_form.billing_full_name }}
                                            {% if billing_form.billing_full_name.errors %}
                                                <div class="text-danger">{{ billing_form.billing_full_name.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="col-4">
                                            <label for="{{ billing_form.billing_phone_number.id_for_label }}">Billing
                                                Phone</label>
                                        </div>
                                        <div class="col-8">
                                            {{ billing_form.billing_phone_number }}
                                            {% if billing_form.billing_phone_number.errors %}
                                                <div class="text-danger">{{ billing_form.billing_phone_number.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="col-4">
                                            <label for="{{ billing_form.billing_email.id_for_label }}">Billing
                                                Email</label>
                                        </div>
                                        <div class="col-8">
                                            {{ billing_form.billing_email }}
                                            {% if billing_form.billing_email.errors %}
                                                <div class="text-danger">{{ billing_form.billing_email.errors }}</div>
                                            {% endif %}

                                        </div>
                                    </div>
                                </div>
                                <h4 class="text-muted">Bill To Address</h4>
                                <div class="ps-3 bs-contact-container">
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="col-4">
                                            <label for="{{ billing_form.billing_street_address.id_for_label }}">Street
                                                Address
                                                1</label>
                                        </div>
                                        <div class="col-8">
                                            {{ billing_form.billing_street_address }}
                                            {% if billing_form.billing_street_address.errors %}
                                                <div class="text-danger">{{ billing_form.billing_street_address.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="col-4">
                                            <label for="{{ billing_form.billing_apartment_suite.id_for_label }}">Street
                                                Address 2</label>
                                        </div>
                                        <div class="col-8">
                                            {{ billing_form.billing_apartment_suite }}
                                            {% if billing_form.billing_apartment_suite.errors %}
                                                <div class="text-danger">{{ billing_form.billing_apartment_suite.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="row p-0 ms-0 city-state-zip-container">
                                            <div class="col-4 filler-column"></div>
                                            <div class="col-8">
                                                <div class="row">
                                                    <div class="col-6 city-col">
                                                        <div class="form-group align-items-center">
                                                            {{ billing_form.billing_city }}
                                                            <label class="ps-2"
                                                                   for="{{ billing_form.billing_city.id_for_label }}">City</label>
                                                            {% if billing_form.billing_city.errors %}
                                                                <div class="text-danger">{{ billing_form.billing_city.errors }}</div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                    <div class="col-3 state-col">
                                                        <div class="form-group align-items-center">
                                                            {{ billing_form.billing_state }}
                                                            <label class="ps-2"
                                                                   for="{{ billing_form.billing_state.id_for_label }}">State</label>
                                                            {% if billing_form.billing_state.errors %}
                                                                <div class="text-danger">{{ billing_form.billing_state.errors }}</div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                    <div class="col-3 zip-col">
                                                        <div class="form-group align-items-center">

                                                            {{ billing_form.billing_zip_code }}
                                                            <label class="ps-2"
                                                                   for="{{ billing_form.billing_zip_code.id_for_label }}">Zip</label>

                                                            {% if billing_form.billing_zip_code.errors %}
                                                                <div class="text-danger">{{ billing_form.billing_zip_code.errors }}</div>
                                                            {% endif %}

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group mb-3 row align-items-center order-contact-info">
                                        <div class="col-4">
                                            <label for="{{ billing_form.billing_country.id_for_label }}">Shipping
                                                Country</label>
                                        </div>
                                        <div class="col-8">
                                            {{ billing_form.billing_country }}
                                            {% if billing_form.billing_country.errors %}
                                                <div class="text-danger">{{ billing_form.billing_country.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-header border-top d-flex align-items-center justify-content-between">
                        <h3 class="m-0">Shipping Method</h3>
                        <span class="edit-button" onclick="toggleEdit('order-shipping-method')">Edit</span>
                    </div>
                    <div class="card-body p-3" id="order-shipping-method">
                        <!-- Button Group for Shipping Method Selection -->
                        <div class="btn-group mb-3" role="group" aria-label="Shipping Method Selection">
                            <input type="radio" class="btn-check" name="shipping_option" id="our_shipping" autocomplete="off"
                                   {% if not shipping_account_form.use_as_default_shipping_method.value %} checked {% endif %}>
                            <label class="btn btn-outline-secondary" for="our_shipping">Our Shipping</label>

                            <input type="radio" class="btn-check" name="shipping_option" id="customer_shipping" autocomplete="off"
                                   {% if shipping_account_form.use_as_default_shipping_method.value %} checked {% endif %}>
                            <label class="btn btn-outline-secondary" for="customer_shipping">Use My Account</label>
                        </div>

                        <!-- Shipping Method Form (Our Shipping) -->
                        <div id="our_shipping_form" {% if shipping_account_form.use_as_default_shipping_method.value %} style="display: none;" {% endif %}>
                            {{ shipping_method_form.as_p }}
                        </div>

                        <!-- Shipping Accounts Form (Customer Shipping) -->
                        <div id="customer_shipping_form">
{#                         {% if not shipping_account_form.use_as_default_shipping_method.value %} style="display: none;" {% endif %}>#}
{#                            {{ shipping_accounts_form.as_p }}#}
                            <!-- Account Number -->
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ shipping_accounts_form.carrier_account_number.id_for_label }}"
                                                   class="form-label">Carrier Account Number</label>
                                            <input type="text"
                                                   name="{{ shipping_accounts_form.carrier_account_number.name }}"
                                                   id="{{ shipping_accounts_form.carrier_account_number.id_for_label }}"
                                                   value="{{ shipping_accounts_form.carrier_account_number.value|default_if_none:'' }}"
                                                   class="form-control text-uppercase">
                                            {% if shipping_accounts_form.carrier_account_number.errors %}
                                                <div class="text-danger">{{ shipping_accounts_form.carrier_account_number.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <!-- Carrier Name -->
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ shipping_accounts_form.carrier_name.id_for_label }}"
                                                   class="form-label">Carrier Name</label>
                                            <select name="{{ shipping_accounts_form.carrier_name.name }}"
                                                    id="{{ shipping_accounts_form.carrier_name.id_for_label }}"
                                                    class="form-control w-100">
                                                {% for choice in shipping_accounts_form.carrier_name.field.choices %}
                                                    <option value="{{ choice.0 }}"
                                                            {% if choice.0 == shipping_accounts_form.carrier_name.value %}selected{% endif %}>
                                                        {{ choice.1 }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                            {% if shipping_accounts_form.carrier_name.errors %}
                                                <div class="text-danger">{{ shipping_accounts_form.carrier_name.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <!-- Shiping Account-->
                                        <div class="col-md-6 mb-3 d-flex gap-2 align-items-center">
                            <input class="form-check-input m-0" type="checkbox"
                                   id="{{ shipping_accounts_form.use_as_default_shipping_method.id_for_label }}"
                                    {% if shipping_accounts_form.use_as_default_shipping_method.value %}
                                   checked {% endif %}>

                            <label for="{{ shipping_accounts_form.use_as_default_shipping_method.id_for_label }}"
                                   class="form-label m-0">Default for all orders</label>
                                   </div>
                                   
                        </div>
                    </div>
                    <div class="card-footer">
                        <button type="button" class="btn btn-primary" id="next-btn-1" data-bs-toggle="tab">Next
                        </button>
                    </div>
                </div>
                <!-- Order Confirmation -->
                <div class="tab-pane fade" id="confirmation" role="tabpanel" aria-labelledby="confirmation-tab">
                    <div class="card-header">
                        <h3 class="m-0">Order Summary</h3>
                    </div>
                    <div class="card-body position-relative">
                        <div class="table p-3">
                            <div class="row fw-bold">
                                <div class="col-6">Item</div>
                                <div class="col-2 text-center">Quantity</div>
                                <div class="col-2 text-start">Price</div>
                                <div class="col-2 text-end">Total</div>
                            </div>
                            {% for item in cart.items.all %}
                                <div class="row">
                                    <div class="col-6">{{ item.auction.title }}</div>
                                    <div class="col-2 text-center">{{ item.quantity }}</div>
                                    <!-- Assuming 'quantity' is a field in CartItem model -->
                                    <div class="col-2 text-start">${{ item.auction.buyItNowPrice }}</div>
                                    <!-- Adjust field name as needed -->
                                    <div class="col-2 text-end">${{ item.total_price }}</div>
                                </div>
                            {% endfor %}

                            <div class="row fw-bold border-top pt-3">
                                <div class="col text-end">Subtotal:</div>
                                <div class="col-1 text-end total-column">${{ cart.total_cost }}</div>
                            </div>
                            <div class="row">
                                <div class="col text-end">Shipping:</div>
                                <div class="col-1 text-end total-column">TBD</div>
                            </div>
                            <div class="row">
                                <div class="col text-end">Taxes:</div>
                                <div class="col-1 text-end total-column">TBD</div>
                            </div>
                            <div class="row fw-bold pt-2">
                                <div class="col"></div>
                                <div class="col-1 border-top text-end total-column">Total:</div>
                                <div class="col-1 border-top text-end total-column">TBD</div>
                            </div>
                        </div>
                        <p class="position-absolute bottom-0 end-0 me-3">Please note: The final total will be provided
                            at the time of order confirmation once shipping
                            has been calculated.</p>
                    </div>

                    <div class="card-footer">
                        <button type="button" class="btn btn-secondary" data-bs-toggle="tab" data-bs-target="#contact">
                            Back
                        </button>
                        <button type="button" class="btn btn-primary" data-bs-toggle="tab" data-bs-target="#payment">
                            Next
                        </button>
                    </div>
                </div>
                <!-- Payment & Submit -->
                <div class="tab-pane fade" id="payment" role="tabpanel" aria-labelledby="payment-tab">
                    <div class="card-header">
                        <h3 class="m-0">Payment Method</h3>
                    </div>
                    <div class="card-body">
                        <!-- Payment Method -->
                        <div class="form-group mb-3">
                            <label for="payment_method">Choose Payment Method</label>
                            <select id="payment_method" name="payment_method" class="form-control">
                                <option value="credit-card">Credit Card</option>
                                <option value="ach">ACH</option>
                                <option value="zelle">Zelle</option>
                                <option value="venmo">Venmo</option>
                                <option value="paypal">PayPal</option>
                                <option value="cashapp">CashApp</option>
                            </select>
                            <div id="cc-logo-container">
                                <img class="payment-logo" src="{% static "images/credit-card-logos.png" %}">
                            </div>
                            <div id="zelle-logo-container">
                                <img class="payment-logo" src="{% static "images/zelle-logo.png" %}">
                            </div>
                            <div id="venmo-logo-container">
                                <img class="payment-logo" src="{% static "images/venmo-logo.png" %}">
                            </div>
                            <div id="paypal-logo-container">
                                <img class="payment-logo" src="{% static "images/paypal-logo.png" %}">
                            </div>
                            <div id="cashapp-logo-container">
                                <img class="payment-logo" src="{% static "images/cashapp-logo.png" %}">
                            </div>
                        </div>
                        <!-- Credit Card Form -->
                        <div id="credit-card-form" class="payment-form">
                            <div class="form-group" id="card-number-field">
                                <label for="{{ credit_card_form.card_number.id_for_label }}">{{ credit_card_form.card_number.label }}</label>
                                {{ credit_card_form.card_number }}
                            </div>
                            <div class="form-group" id="expiration-date">
                                <label for="{{ credit_card_form.expiration_date.id_for_label }}">{{ credit_card_form.expiration_date.label }}</label>
                                {{ credit_card_form.expiration_date }}
                            </div>
                            <div class="form-group">
                                <label for="{{ credit_card_form.cvv.id_for_label }}">{{ credit_card_form.cvv.label }}</label>
                                {{ credit_card_form.cvv }}
                            </div>
                        </div>
                        <!-- ACH Form -->
                        <div id="ach-form" class="payment-form" style="display: none;">
                            <p class="ms-3">ACH instructions will be sent to your email address along with the order
                                confirmation.
                                Please check your inbox for further details on how to complete your payment.</p>

                        </div>
                        <!-- Zelle Form -->
                        <div id="zelle-form" class="payment-form" style="display: none;">
                            {{ zelle_form.as_p }}
                        </div>
                        <!-- Venmo Form -->
                        <div id="venmo-form" class="payment-form" style="display: none;">
                            {{ venmo_form.as_p }}
                        </div>
                        <!-- Paypal Form -->
                        <div id="paypal-form" class="payment-form" style="display: none;">
                            {{ paypal_form.as_p }}
                        </div>
                        <!-- Cashapp Form -->
                        <div id="cashapp-form" class="payment-form" style="display: none;">
                            {{ cashapp_form.as_p }}
                        </div>

                        <div class="form-group form-check mt-3 ms-3">
                            <input type="checkbox" class="form-check-input" id="id_agree_terms" required>
                            <label class="form-check-label" for="id_agree_terms">
                                I agree to the
                                <a href="{% url 'terms_and_conditions' %}" target="_blank">Terms and Conditions</a>
                                and
                                <a href="{% url 'privacy_policy' %}" target="_blank">Privacy Policy</a>.
                            </label>
                        </div>
                    </div>
                    <div class="card-footer d-flex gap-2">
                        <button type="button" class="btn btn-secondary" data-bs-toggle="tab"
                                data-bs-target="#confirmation">Back
                        </button>
                        <div id="submitContainer">
                            <button type="submit" class="btn btn-primary" id="orderButton">Place Order</button>
                        </div>
                    </div>
                </div>
            </div> 
        </form>
    </div>
    
<!-- Checkout Instructions Modal -->
<div class="modal fade" id="checkoutInstructionsModal" tabindex="-1" aria-labelledby="checkoutInstructionsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="checkoutInstructionsModalLabel">Checkout</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="d-flex justify-content-center"><strong>Ready to wrap things up? Let's get your order rolling!</strong></p>
                <ol>
                    <li class="mb-2"><strong>Contact & Shipping:</strong> Kick things off by filling in your contact details, where and how you want your order to arrive.</li>
                    <li class="mb-2"><strong>Order Confirmation:</strong> Double-check everything’s in place and looking good before you hit the go button.</li>
                    <li class="mb-2"><strong>Payment & Submit:</strong> Choose your preferred way to pay, and seal the deal.</li>
                </ol>
                <p>Once your order is placed, our team will personally reach out to finalize the details. Unlike fully automated sites, we work closely with both buyers and sellers to ensure a smooth transaction and keep the process as seamless as possible for you.</p>
                <p>Regardless of this is your first order or number one thousand, thank you for your business!!</p> 

                <div class="form-check mt-3 ms-4">
                    <input type="checkbox" class="form-check-input" id="hideInstructionsForever">
                    <label class="form-check-label" for="hideInstructionsForever">Don't show this again</label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Got it!</button>
            </div>
        </div>
    </div>
</div>


    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.maskedinput/1.4.1/jquery.maskedinput.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/payform@1.4.0/dist/payform.min.js"></script>
    <script src='{% static "js/checkout.js" %}'></script>
        <link href='{% static "css/checkout.css" %}' rel='stylesheet'>
    <!-- Masks and Tab Controls -->
    <script>
        $(document).ready(function () {
            $('#id_phone_number').mask("(999) 999-9999");
            $('#id_shipping_phone_number').mask("(999) 999-9999");
            $('#id_billing_phone_number').mask("(999) 999-9999");
            

            // Handle tab navigation
            $('#checkoutTabs button').on('click', function () {
                let target = $(this).data('bs-target');
                let tab = new bootstrap.Tab($(target)[0]);
                tab.show();
            });

            // Manually trigger tab change when clicking Next/Back buttons
            $("#next-btn-1").on("click", function () {
                let nextTab = new bootstrap.Tab("#confirmation-tab");
                nextTab.show();
            });

            $("#confirmation .btn-secondary").on("click", function () {
                let prevTab = new bootstrap.Tab("#contact-tab");
                prevTab.show();
            });

            $("#confirmation .btn-primary").on("click", function () {
                let nextTab = new bootstrap.Tab("#payment-tab");
                nextTab.show();
            });

            $("#payment .btn-secondary").on("click", function () {
                let prevTab = new bootstrap.Tab("#confirmation-tab");
                prevTab.show();
            });

            $('#copyEmailButton').click(function () {
                // Get the value from the email input field
                let emailValue = $('#id_email').val();
                // Set the value to the shipping email input field
                $('#id_shipping_email').val(emailValue);
            });

            $('#zelle-logo-container').hide();
            $('#venmo-logo-container').hide();
            $('#paypal-logo-container').hide();
            $('#cashapp-logo-container').hide();


            $('#payment_method').on('change', function () {
                let selectedMethod = $(this).val();
                $('.payment-form').hide();
                $('#' + selectedMethod + '-form').show();
                if (selectedMethod == 'credit-card') {
                    $('#cc-logo-container').show();
                } else {
                    $('#cc-logo-container').hide();
                }
                if (selectedMethod == 'zelle') {
                    $('#zelle-logo-container').show();
                } else {
                    $('#zelle-logo-container').hide();
                }
                if (selectedMethod == 'venmo') {
                    $('#venmo-logo-container').show();
                } else {
                    $('#venmo-logo-container').hide();
                }
                if (selectedMethod == 'paypal') {
                    $('#paypal-logo-container').show();
                } else {
                    $('#paypal-logo-container').hide();
                }
                if (selectedMethod == 'cashapp') {
                    $('#cashapp-logo-container').show();
                } else {
                    $('#cashapp-logo-container').hide();
                }
            });


        });
    </script>
    <!-- Payment Field Controls -->
    <script>
        $(document).ready(function () {
            function updateRequiredFields() {
                // Clear all required attributes first
                $('#credit-card-form input').removeAttr('required');
                $('#credit-card-form input').removeClass('required');
                $('#ach-form input').removeAttr('required');
                $('#zelle-form input').removeAttr('required');
                $('#zelle-form input').removeClass('required');
                $('#venmo-form input').removeAttr('required');
                $('#venmo-form input').removeClass('required');
                $('#paypal-form input').removeAttr('required');
                $('#paypal-form input').removeClass('required');
                $('#cashapp-form input').removeAttr('required');
                $('#cashapp-form input').removeClass('required');

                // Get the selected payment method
                let selectedMethod = $('#payment_method').val();

                // Add required attribute to the relevant fields based on the selected method
                if (selectedMethod === 'credit-card') {
                    $('#credit-card-form input').attr('required', 'required');
                    $('#credit-card-form input').addClass('required');
                } else if (selectedMethod === 'ach') {
                    $('#ach-form input').attr('required', 'required');
                } else if (selectedMethod === 'zelle') {
                    $('#zelle-form input').attr('required', 'required');
                    $('#zelle-form input').addClass('required');
                } else if (selectedMethod === 'venmo') {
                    $('#venmo-form input').attr('required', 'required');
                    $('#venmo-form input').addClass('required');
                } else if (selectedMethod === 'paypal') {
                    $('#paypal-form input').attr('required', 'required');
                    $('#paypal-form input').addClass('required');
                } else if (selectedMethod === 'cashapp') {
                    $('#cashapp-form input').attr('required', 'required');
                    $('#cashapp-form input').addClass('required');
                }
            }

            // Update required fields when the payment method changes
            $('#payment_method').on('change', function () {
                updateRequiredFields();
            });

            // Also call the function on page load to set the initial state
            updateRequiredFields();
        });
    </script>
    <!-- Order Validation -->
    <script>
        $(document).ready(function () {
    function validateAndSubmitForm() {
        let missingFields = [];

        // Loop through all required fields
        $('.required').each(function () {
            if (!$(this).val()) {
                // Find the corresponding label using the input's id and the label's for attribute
                let label = $(`label[for="${$(this).attr('id')}"]`).text();
                missingFields.push({
                    id: $(this).attr('id'),
                    label: label || 'Field' // Fallback if label is not found
                });
            }
        });

        // If there are missing fields, show SweetAlert2
        if (missingFields.length > 0) {
            let inputsHtml = '';
            // Generate HTML for SweetAlert2 input fields based on missing fields
            missingFields.forEach(field => {
                inputsHtml += `
                    <div class="mb-2">
                        <label class="text-body text-start w-100 fs-6 mb-1" for="swal-input-${field.id}">${field.label}</label>
                        <input type="text" id="swal-input-${field.id}" class="form-control swal-input" placeholder="Enter ${field.label.toLowerCase()}">
                    </div>
                `;
            });

            // Show SweetAlert2 with the inputs for missing fields
            Swal.fire({
                title: 'Please fill the required fields',
                html: inputsHtml,
                showCancelButton: true,
                focusConfirm: false,
                confirmButtonText: 'Submit',
                customClass: {
                    popup: 'rounded',
                    confirmButton: 'btn btn-primary me-2',  // Apply Bootstrap primary button class
                    cancelButton: 'btn btn-secondary ms-2',   // Optional: Apply Bootstrap secondary button class
                    title: 'h3 border-bottom pb-2 bg-light rounded-top',
                },
                buttonsStyling: false,  // Disable default SweetAlert2 styling for buttons
                preConfirm: () => {
                    // Update form fields with SweetAlert2 inputs
                    missingFields.forEach(field => {
                        let value = $(`#swal-input-${field.id}`).val();
                        if (value) {
                            $(`#${field.id}`).val(value);
                        }
                    });
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // Submit the form via AJAX after updating the fields
                    submitFormViaAjax();
                }
            });
        } else {
            // No missing fields, submit the form via AJAX
            submitFormViaAjax();
        }
    }

  function submitFormViaAjax() {
    let form = $('form');  // Reference to the form
    let formData = form.serialize();  // Serialize the form data

    $.ajax({
        type: 'POST',
        url: form.attr('action'),  // Use the form's action attribute as the URL
        data: formData,
        dataType: 'json',
        success: function (response) {
    console.log('Response received:', response);  // Debugging line

    if (response.status === 'success') {
        const order = response.order;

        // Check if order exists and has the expected structure
        if (order && order.items && order.items.length > 0) {
            // Generate order details HTML
            let orderDetailsHtml = `
                <div id="order-confirmation-content">
                    <h2 class="w-100 text-center fw-bold pb-3 mb-3 border-bottom">Thank you for your order!</h2>
                    <h3 class="w-100 text-start" style="margin-top: 20px; font-weight: bold;">Shipping Information</h3>
                    ${order.shipping_address ? `
                        <div class="row">
                            <div class="col-auto text-start">
                                <div>${order.shipping_address.shipping_full_name}</div> 
                                <div>${order.shipping_address.shipping_street_address}, ${order.shipping_address.shipping_apartment_suite}</div>

                                <div class="row"> 
                                    <div class="col-auto">${order.shipping_address.shipping_city},</div>
                                    <div class="col-auto">${order.shipping_address.shipping_state}</div>
                                    <div class="col-auto">${order.shipping_address.shipping_zip_code}</div>
                                </div>
                                <div>${order.shipping_address.shipping_country}</div>
                            </div>
                        </div>
                    ` : `<p>No shipping address available.</p>`}
            

                 <h3 class="w-100 text-start" style="margin-top: 20px; font-weight: bold;">Order Summary</h3>
                <ul style="list-style-type: none; padding: 0;">
            `;

            order.items.forEach(item => {
                orderDetailsHtml += `
                    <li style="border-bottom: 1px solid #ccc; padding: 10px 0;">
                        <div class="row">
                            <div class="col-2 text-center">Quantity</div>
                            <div class="col-8 text-start">Description</div>
                            <div class="col-2 text-end">Price</div>
                        </div>
                    </li>
                    <li style="border-bottom: 1px solid #ccc; padding: 10px 0;">
                        <div class="row">
                            <div class="col-2 text-center">${item.quantity}</div>
                            <div class="col-8 text-start">${item.auction_title}</div>
                            <div class="col-2 text-end">$${item.price}</div>
                        </div>
                    </li>
                `;
            });
            orderDetailsHtml += `
                </ul>
                <p style="font-weight: bold; text-align: right; margin-top: 20px;">Total: $${order.total_amount}</p>

                <p class="text-start">Your order number is <strong>${order.id}</strong>.</p>
                <p class="text-start">You will receive an email confirmation shortly at <strong>${order.email}</strong>.</p>
                <p class="text-start">If you have any questions about your order, please <a href="{% url 'inbox' %}" target="_blank">contact us</a>.</p>
            </div>`;

            // Display order confirmation in SweetAlert2
            Swal.fire({
                title: '',
                html: orderDetailsHtml,
                icon: 'success',
                showCancelButton: true,
                confirmButtonText: 'OK',
                cancelButtonText: 'Print',
                customClass: {
                    confirmButton: 'btn btn-primary me-2',
                    cancelButton: 'btn btn-secondary ms-2',
                    popup: 'custom-swal-width'
                },
                buttonsStyling: false,
            }).then((result) => {
                if (result.isConfirmed) {
                    // Redirect to order confirmation page or any other action
                    window.location.href = `/auction/active`;
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    // Handle print action
                    printOrderConfirmation();
                }
            });
        } else {
            console.error('Order data is missing or invalid:', order);  // Debugging line
        }
    } else if (response.status === 'error') {
        Swal.fire({
            title: 'Error',
            text: response.message,
            icon: 'error',
            confirmButtonText: 'OK',
            customClass: {
                confirmButton: 'btn btn-primary'
            },
            buttonsStyling: false
        });
    }
},

        error: function (xhr, status, error) {
            Swal.fire({
                title: 'Submission Failed',
                text: 'There was an error processing your order. Please try again.',
                icon: 'error',
                confirmButtonText: 'OK',
                customClass: {
                    confirmButton: 'btn btn-primary'
                },
                buttonsStyling: false
            });
        }
    });
}

function printOrderConfirmation() {
    const orderContent = document.getElementById('order-confirmation-content').innerHTML;
    const printWindow = window.open('', '', 'height=600,width=800');
    printWindow.document.write('<html><head><title>Order Confirmation</title>');
    printWindow.document.write('<link rel="stylesheet" href="{% static "css/checkout.css" %}" type="text/css"/>'); // Adjust the path to your CSS file
    printWindow.document.write('<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" type="text/css"/>'); // Bootstrap CDN
    printWindow.document.write('</head><body >');
    printWindow.document.write(orderContent);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    printWindow.print();
    
    // Navigate to auction/active after a slight delay
    setTimeout(() => {
        window.location.href = '/auction/active';
    }, 1000); // Adjust the delay time as needed
}



    // Bind the validate function to the submit button click event
    $('button[type="submit"]').on('click', function (e) {
        e.preventDefault(); // Prevent the default form submission
        validateAndSubmitForm(); // Call the validation function
    });
});


    </script>
{% endblock %}
